<!doctype html>

<html>

  <head>
    <meta http-equiv='content-type' content='text/html; charset=utf-8'>
    <meta name="viewport" content="width=device-width, user-scalable=0">
    <title>Chartabull Demo</title>
    <link rel='stylesheet' href='chartabull.css'>
    <script src='bower_components/jquery/dist/jquery.js'></script>
    <script src='bower_components/underscore/underscore.js'></script>
    <script src='chartabull.js'></script>
    <style>
      body{
        font-family: 'helvetica neue', arial, helvetica, verdana, sans-serif;
        text-align: center;
      }
      canvas{
        clear: both;
        margin: 0 auto;
      }
      .chart{
        height: 150px;
        color: #aaa;
        text-shadow: 0px 1px 0px white;
      }
      .chart .number{
        position: relative;
        left: -80px;
        font-size: 50px;
        font-weight: 600;
        top: 130px;
      }
      .chart .text{
        position: relative;
        top: 130px;
        left: -80px;
      }
    </style>
  </head>

  <body>
    <h1>The Simplest Chart</h1>
    <div class="chart">
      <canvas height="150" width="300" class="js-chartabull" id="canvas-me2" data-values="[74,100]" data-options='{}' data-text="Out of 100"></canvas>
    </div>
  </body>

</html>



<script>
  (function () {
    'use strict';
    // Store a local reference to jQuery and Underscore.
    var $ = window.jQuery;
    var _ = window._;

    var Chartabull = window.Chartabull = function(el, data, options, chartText){
      _.extend(this, options);
      this.buildChart(el, data);
      this.buildText(el, data, chartText);
    }

    _.extend(Chartabull.prototype, {
      // Color for area fill
      chartColor: '#eee;',

      // Font Stylings used in text laid on top
      fontFamily: "'helvetica neue', arial, verdana, sans-serif",
      textColor: '#aaa;',
      textPadding: 20,
      smallFont: "normal 24px",
      largeFont: "bold 50px",

      // Background of Chart
      backgroundColor: "#fff",

      // Set up the canvas
      canvas: document.getElementById('canvas-me2'),

      // Drop some text on the graph
      buildText: function(el, data, chartText){
        var height = el.height(),
            width = el.width();

        var context = this.canvas.getContext("2d");

        context.fillStyle = this.textColor;
        context.font = this.largeFont + this.fontFamily;
        context.fillText(data[0], this.textPadding, height-50);
        context.font = this.smallFont + this.fontFamily;
        context.fillText(chartText, this.textPadding, height-this.textPadding);

        return this;
      },

      // Draw the chart itself
      buildChart: function(el,data){
        var height = el.height(),
            width = el.width(),
            midX = width/2,
            midY = height/2,
            dataSize = _.size(data);

        var sum = _.reduce(data, function(memo, num){ return memo + num; }, 0);
        var drawContext = this.canvas.getContext("2d");

        var x = width/2;
        var y = height/2;
        var r = _.min([width,height])/2;

        // Fill the background
        drawContext.fillStyle = this.backgroundColor;
        drawContext.fillRect(0,0, width, height);

        // Draw the circle
        drawContext.beginPath();
        drawContext.arc(x, y, r, 0, (Math.PI * 2) * (data[0]/data[1]), false);
        drawContext.lineTo(x,y);
        drawContext.closePath();
        drawContext.fillStyle = this.chartColor;
        drawContext.fill();
      }
    });

    $('.js-chartabull').each(function () {
      var $self = $(this);
      var data = $self.data();
      new Chartabull($self, data.values, data.options, data.text);
    });
  })();
</script>
